# JS垃圾回收机制

- 垃圾回收机制(Garbage Collection)简称GC
- JS中**内存的分配和回收**是**自动完成**的，内存在不使用的时候会被**垃圾回收器**自动回收

## 1. 内存的生命周期

JS环境中分配的内存，一般有如下生命周期

- **内存分配**：声明变量、函数、对象的时候，系统会自动为他们分配内存
- **内存使用**：即读写内存，也就是使用变量、函数等
- **内存回收**：使用完毕，由**垃圾回收器**自动回收不再使用的内存
- **全局变量**一般不会回收（关闭页面时回收）
- 一般情况下**局部变量**的值**不用会被自动回收**
- 内存泄漏：程序中**分配的内存**由于某些原因程序**未释放或无法释放**叫内存泄露

## 2. 算法说明

- 栈：由**操作系统自动分配释放**函数的参数值、局部变量等，基本数据类型放到栈里面
- 堆：一般由程序员分配释放，若程序员不释放，由**垃圾回收机制**回收，**复杂数据类型**放到堆里面

## 3. 引用计数法

- IE采用的算法，定义”内存不再使用“，就是看一个对象是否有指向它的引用，没有引用就回收
  - 1、跟踪记录**被引用的次数**
  - 2、如果被引用次数为1就记录为1，多次引用就++
  - 3、如果减少一个引用就--
  - 4、如果引用次数为0就释放内存
- 缺点：嵌套引用（循环引用）
  - 如果两个对象互相引用，尽管已经不会使用，垃圾回收器也不会进行回收，导致内存泄漏
  - ![image-20240603110235495](前端.assets/image-20240603110235495-17173837568701.png)
  - 因为他们的引用次数永远不会是0 

## 4. 标记清除法

- 标记清除法将”不再使用的对象“定义为”**无法达到的对象**“
- 就是从**根部（在JS中就是全局对象）**出发定时扫描内存中的对象。凡是**能从根部到达的对象都是还需要使用的**
- 那些无法由根部出发触及到的对象被**标记为不再使用，稍后进行回收**

## 5. 深入
- 需要涉及到调用栈、堆空间以及主副垃圾回收器……所以直接跳转
- 浏览器原理文档  13.13垃圾回收：垃圾数据是如何自动回收的？
- [点击跳转](https://juejin.cn/post/7138038723958030350?searchId=2025041715562648D304953AB3A0EAB0FF)
<GiscusComment />